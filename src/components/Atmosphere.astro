---
/**
 * Atmosphere Component
 * Full viewport canvas with particle system and gradient background
 */
---

<div class="atmosphere">
  <div class="gradient-base"></div>
  <canvas id="particle-canvas"></canvas>
</div>

<script>
  import { ParticleSystem } from '../lib/particles';

  // Initialize particle system
  const canvas = document.getElementById('particle-canvas') as HTMLCanvasElement;
  if (canvas) {
    // Set initial size
    const setCanvasSize = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };

    setCanvasSize();

    // Create particle system with 600 particles
    const particleSystem = new ParticleSystem(canvas, 600);

    // Handle resize
    let resizeTimeout: number;
    window.addEventListener('resize', () => {
      // Debounce resize
      clearTimeout(resizeTimeout);
      resizeTimeout = window.setTimeout(() => {
        particleSystem.resize(window.innerWidth, window.innerHeight);
      }, 100);
    });

    // Start animation
    particleSystem.start();

    // Cleanup on page navigation (for future SPA functionality)
    document.addEventListener('astro:before-swap', () => {
      particleSystem.destroy();
    });
  }
</script>

<style>
  .atmosphere {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    height: 100dvh;
    overflow: hidden;
    z-index: 0;
  }

  .gradient-base {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Multi-directional gradient creating depth */
    background:
      /* Subtle radial from center for atmosphere */
      radial-gradient(
        ellipse 120% 100% at 50% 50%,
        var(--mid) 0%,
        var(--base) 40%,
        var(--deep) 100%
      ),
      /* Secondary radial from bottom-left for asymmetry */
      radial-gradient(
        ellipse 80% 60% at 20% 80%,
        var(--base) 0%,
        transparent 60%
      ),
      /* Tertiary radial from top-right */
      radial-gradient(
        ellipse 60% 50% at 85% 15%,
        var(--base) 0%,
        transparent 50%
      ),
      /* Base color */
      var(--deep);
    background-blend-mode: screen, screen, screen, normal;
  }

  #particle-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
</style>
