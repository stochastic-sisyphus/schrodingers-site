---
/**
 * Projects directory - all GitHub repos
 */

import ContentLayout from '@/layouts/ContentLayout.astro';
import { fetchAllRepos, getFeaturedRepos } from '@/lib/github';

const repos = await fetchAllRepos();
const featuredRepos = getFeaturedRepos(repos);
---

<ContentLayout title="Projects | stochastic-sisyphus">
  <article class="projects-list">
    <h1 class="page-title">projects</h1>

    <p class="page-description">
      Explorations in code, data, and emergent systems. Each project represents
      a different approach to computational thinking.
    </p>

    {featuredRepos.length > 0 && (
      <section class="featured-section">
        <h2 class="section-title">featured</h2>

        <div class="projects-grid featured">
          {featuredRepos.map((repo) => (
            <a
              href={`/projects/${repo.name}`}
              class="project-card frosted-glass featured-card"
            >
              <div class="card-header">
                <h3 class="project-name">{repo.name}</h3>
                <span class="featured-badge">featured</span>
              </div>

              {repo.description && (
                <p class="project-description">{repo.description}</p>
              )}

              <div class="project-meta">
                {repo.language && (
                  <span class="language">{repo.language}</span>
                )}

                {repo.stargazers_count > 0 && (
                  <span class="stars">★ {repo.stargazers_count}</span>
                )}
              </div>

              {repo.topics.length > 0 && (
                <div class="project-topics">
                  {repo.topics.slice(0, 3).map((topic) => (
                    <span class="topic">{topic}</span>
                  ))}
                </div>
              )}
            </a>
          ))}
        </div>
      </section>
    )}

    <section class="all-projects-section">
      <h2 class="section-title">all projects</h2>

      <div class="projects-grid">
        {repos.map((repo) => (
          <a href={`/projects/${repo.name}`} class="project-card frosted-glass">
            <h3 class="project-name">{repo.name}</h3>

            {repo.description && (
              <p class="project-description">{repo.description}</p>
            )}

            <div class="project-meta">
              {repo.language && (
                <span class="language">{repo.language}</span>
              )}

              {repo.stargazers_count > 0 && (
                <span class="stars">★ {repo.stargazers_count}</span>
              )}

              <time datetime={repo.updated_at}>
                Updated {new Date(repo.updated_at).toLocaleDateString('en-US', {
                  month: 'short',
                  year: 'numeric',
                })}
              </time>
            </div>

            {repo.topics.length > 0 && (
              <div class="project-topics">
                {repo.topics.slice(0, 3).map((topic) => (
                  <span class="topic">{topic}</span>
                ))}
              </div>
            )}
          </a>
        ))}
      </div>
    </section>
  </article>
</ContentLayout>

<style>
  .projects-list {
    max-width: 1400px;
    margin: 0 auto;
  }

  .page-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(48px, 6vw, 72px);
    font-weight: 300;
    color: var(--highlight);
    margin: 0 0 1.5rem 0;
    letter-spacing: 0.02em;
  }

  .page-description {
    color: var(--light);
    font-size: 1.125rem;
    line-height: 1.6;
    margin: 0 0 4rem 0;
    max-width: 800px;
  }

  .featured-section,
  .all-projects-section {
    margin-bottom: 4rem;
  }

  .section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 500;
    color: var(--accent);
    margin: 0 0 2rem 0;
    letter-spacing: 0.02em;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
  }

  .projects-grid.featured {
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  }

  .project-card {
    background: rgba(68, 88, 104, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(166, 182, 194, 0.2);
    border-radius: 12px;
    padding: 2rem;
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .project-card:hover {
    background: rgba(68, 88, 104, 0.15);
    border-color: rgba(166, 182, 194, 0.3);
    transform: translateY(-2px);
  }

  .featured-card {
    background: rgba(68, 88, 104, 0.15);
    border-color: rgba(166, 182, 194, 0.25);
  }

  .card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
  }

  .featured-badge {
    padding: 0.25rem 0.75rem;
    background: rgba(166, 182, 194, 0.2);
    border-radius: 4px;
    font-size: 0.75rem;
    color: var(--accent);
    white-space: nowrap;
  }

  .project-name {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.25rem;
    font-weight: 500;
    color: var(--highlight);
    margin: 0;
    word-break: break-word;
  }

  .project-description {
    color: var(--light);
    line-height: 1.6;
    margin: 0;
    flex-grow: 1;
  }

  .project-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
    font-size: 0.875rem;
    color: var(--accent);
  }

  .language {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .language::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
  }

  .stars {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .project-topics {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .topic {
    padding: 0.25rem 0.75rem;
    background: rgba(166, 182, 194, 0.1);
    border-radius: 4px;
    font-size: 0.75rem;
    color: var(--accent);
  }

  @media (max-width: 768px) {
    .projects-grid,
    .projects-grid.featured {
      grid-template-columns: 1fr;
    }
  }
</style>
