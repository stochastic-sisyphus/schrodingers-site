---
/**
 * Blog post list page
 */

import ContentLayout from '@/layouts/ContentLayout.astro';
import { getCollection } from 'astro:content';
import { fetchAllSubstackPosts } from '@/lib/substack';
import BlogList from '@/components/BlogList.astro';

// Fetch content from both sources
const localPosts = await getCollection('blog', ({ data }) => !data.draft);
const substackPosts = await fetchAllSubstackPosts().catch(() => []);

// Combine and sort by date
const allPosts = [
  ...localPosts.map(post => ({
    slug: post.slug,
    title: post.data.title,
    date: post.data.date,
    excerpt: post.data.excerpt,
    tags: post.data.tags,
    substackUrl: post.data.substackUrl,
    isLocal: true,
  })),
  ...substackPosts.map(post => ({
    slug: post.slug,
    title: post.title,
    date: post.date,
    excerpt: post.excerpt,
    tags: post.tags,
    substackUrl: post.substackUrl,
    isLocal: false,
  })),
].sort((a, b) => b.date.getTime() - a.date.getTime());
---

<ContentLayout
  title="Writing | stochastic-sisyphus"
  description="Explorations in code, systems, and emergence. Essays and technical writing on computational thinking and data systems."
>
  <article class="blog-page">
    <h1 class="page-title">writing</h1>

    <BlogList posts={allPosts} columns={3} />
  </article>
</ContentLayout>

<style>
  .blog-page {
    max-width: 1200px;
    margin: 0 auto;
  }

  .page-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(48px, 6vw, 72px);
    font-weight: 300;
    color: var(--highlight);
    margin: 0 0 4rem 0;
    letter-spacing: 0.02em;
  }
</style>
