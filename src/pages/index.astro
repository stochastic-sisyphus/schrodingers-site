---
/**
 * Homepage - Atmospheric Entry Point
 * Phase 6: Content zones with atmospheric scrolling
 */
import { getCollection } from 'astro:content';
import { fetchAllRepos, getFeaturedRepos } from '../lib/github';
import Atmosphere from '../components/Atmosphere.astro';
import ProjectCard from '../components/ProjectCard.svelte';
import BlogCard from '../components/BlogCard.astro';
import ResearchCard from '../components/ResearchCard.astro';
import '../styles/global.css';

// Fetch featured content
const allRepos = await fetchAllRepos();
const featuredRepos = getFeaturedRepos(allRepos).slice(0, 3);

// Get recent blog posts (limit to 3)
const allBlogPosts = await getCollection('blog', ({ data }) => {
  return !data.draft;
});
const recentPosts = allBlogPosts
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);

// Get key research papers (featured or most recent)
const allResearch = await getCollection('research');
const keyResearch = allResearch
  .filter(({ data }) => data.featured)
  .slice(0, 3);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Computational atmospheres where identity and work exist as living data. Explorations in code, data systems, and emergent patterns." />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&family=Inter:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <title>stochastic-sisyphus | computational atmospheres</title>

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="stochastic-sisyphus | computational atmospheres" />
    <meta property="og:description" content="Computational atmospheres where identity and work exist as living data. Explorations in code, data systems, and emergent patterns." />
    <meta property="og:url" content="https://stochastic-sisyphus.pages.dev" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="stochastic-sisyphus | computational atmospheres" />
    <meta name="twitter:description" content="Computational atmospheres where identity and work exist as living data. Explorations in code, data systems, and emergent patterns." />
  </head>
  <body>
    <Atmosphere />

    <!-- Hero Section -->
    <section class="hero" aria-label="Site introduction">
      <h1 class="identity">stochastic-sisyphus</h1>
      <nav class="hero-nav">
        <a href="/projects">projects</a>
        <a href="/blog">writing</a>
        <a href="/research">research</a>
      </nav>
    </section>

    <!-- Content Zones -->
    <main class="content-zones">
      <!-- Featured Work -->
      {featuredRepos.length > 0 && (
        <section class="content-zone" data-zone="projects">
          <header class="zone-header">
            <h2 class="zone-title">Featured Work</h2>
          </header>
          <div class="content-grid">
            {featuredRepos.map((repo) => (
              <div class="grid-item">
                <ProjectCard repo={repo} featured={true} client:visible />
              </div>
            ))}
          </div>
          <a href="/projects" class="view-more" aria-label="Navigate to all projects">View all projects</a>
        </section>
      )}

      <!-- Recent Writing -->
      {recentPosts.length > 0 && (
        <section class="content-zone" data-zone="blog">
          <header class="zone-header">
            <h2 class="zone-title">Recent Writing</h2>
          </header>
          <div class="content-grid">
            {recentPosts.map((post) => (
              <div class="grid-item">
                <BlogCard
                  title={post.data.title}
                  date={post.data.date}
                  excerpt={post.data.excerpt}
                  tags={post.data.tags}
                  slug={post.slug}
                  substackUrl={post.data.substackUrl}
                  isExternal={!!post.data.substackUrl}
                />
              </div>
            ))}
          </div>
          <a href="/blog" class="view-more" aria-label="Navigate to all blog posts">View all posts</a>
        </section>
      )}

      <!-- Key Research -->
      {keyResearch.length > 0 && (
        <section class="content-zone" data-zone="research">
          <header class="zone-header">
            <h2 class="zone-title">Research</h2>
            <p class="zone-subtitle">Academic contributions and publications</p>
          </header>
          <div class="content-grid">
            {keyResearch.map((paper) => (
              <div class="grid-item">
                <ResearchCard
                  id={paper.slug}
                  title={paper.data.title}
                  authors={paper.data.authors}
                  year={paper.data.year}
                  journal={paper.data.journal}
                  doi={paper.data.doi}
                  orcidUrl={paper.data.orcidUrl}
                  abstract={paper.data.abstract}
                  type={paper.data.type}
                  isLocal={true}
                />
              </div>
            ))}
          </div>
          <a href="/research" class="view-more" aria-label="Navigate to all research publications">View all research</a>
        </section>
      )}
    </main>

    <!-- Initialize scroll animations -->
    <script>
      import { initAllScrollAnimations } from '../lib/scroll-animations';
      initAllScrollAnimations();
    </script>
  </body>
</html>

<style>
  .hero {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
  }

  .identity {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: clamp(3rem, 8vw, 6rem);
    font-weight: 300;
    letter-spacing: 0.02em;
    color: var(--highlight);
    opacity: 0;
    animation: fadeIn 1.5s ease-out 0.5s forwards;
    margin: 0;
    text-align: center;
    text-shadow: 0 2px 12px rgba(20, 26, 32, 0.9);
  }

  .hero-nav {
    display: flex;
    gap: 3rem;
    opacity: 0;
    animation: fadeIn 1.5s ease-out 1.2s forwards;
  }

  .hero-nav a {
    font-family: 'Inter', sans-serif;
    font-size: 1.125rem;
    font-weight: 500;
    color: var(--highlight);
    text-decoration: none;
    letter-spacing: 0.03em;
    transition: color 0.3s ease;
    position: relative;
  }

  .hero-nav a::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--highlight);
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .hero-nav a:hover {
    color: var(--highlight);
  }

  .hero-nav a:hover::after {
    transform: scaleX(1);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Enable pointer events on content zones */
  .content-zones {
    pointer-events: auto;
    padding-top: 4rem;
  }

  /* Make links and interactive elements accessible */
  .content-zones a,
  .content-zones button {
    pointer-events: auto;
  }

  @media (max-width: 768px) {
    .identity {
      font-size: 2.5rem;
    }

    .hero-nav {
      gap: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .hero-nav a {
      font-size: 1rem;
    }
  }
</style>
